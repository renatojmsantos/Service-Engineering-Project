{"ast":null,"code":"var _jsxFileName = \"/Users/renatosantos/Dropbox/Aplicativos/NONIO-Inforestudante/Licenciatura em Engenharia Informa\\u0301tica/2019 2020/2.\\xBA Semestre/Engenharia de Servic\\u0327os/Service-Engineering-Project/src/AddressForm.js\";\nimport React, { Component } from 'react';\nimport AddressSuggest from './AddressSuggest';\nimport AddressInput from './AddressInput';\nimport axios from 'axios';\nimport TranscribeFetch from './getTranscribeStatus';\nimport { Route53Resolver } from 'aws-sdk';\nconst API_KEY = 'tX1z9uiD44rPpVd1CGR_eG3VBZ4mubljw0ljaLFIaRQ';\n\nclass AddressForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = this.getInitialState(); // User has entered something in the address bar\n\n    this.onQuery = this.onQuery.bind(this); // User has entered something in an address field\n\n    this.onAddressChange = this.onAddressChange.bind(this); // User has clicked the check button\n\n    this.onCheck = this.onCheck.bind(this);\n  }\n\n  onQuery(evt) {\n    const query = evt.target.value;\n    const self = this;\n    axios.get('https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json', {\n      'params': {\n        'query': query,\n        'apiKey': API_KEY,\n        'maxresults': 20 // nr de resultados relacionados com a palavras pesquisadas\n\n      }\n    }).then(function (response) {\n      console.log(\"sugestao\");\n      console.log(response);\n\n      if (response.data.suggestions.length > 0) {\n        const id = response.data.suggestions[0].locationId;\n        const address = response.data.suggestions[0].address;\n        self.setState({\n          'address': address,\n          'query': query,\n          'locationId': id\n        });\n      } else {\n        const state = self.getInitialState();\n        self.setState(state);\n      }\n    });\n  }\n\n  getInitialState() {\n    //console.log(this.getText());\n    var textTranscribe = this;\n    axios.get('https://3xeam2g64j.execute-api.us-east-1.amazonaws.com/transcribe/transcribe').then(function (response) {\n      textTranscribe = response.data.body;\n      console.log(\"llll \" + textTranscribe); //right string\n    }); //console.log(\"trans...\"+JSON.stringify(textTranscribe)); // object object\n\n    console.log(\"----- transcribe ------\");\n    console.log(textTranscribe);\n    return {\n      'address': {\n        'street': '',\n        //textTranscribe.toString(), //white white, //inserir aqui texto do transcribe\n        'city': '',\n        'postalCode': '',\n        'country': ''\n      },\n      'query': '',\n      'locationId': '',\n      'isChecked': false,\n      'coords': {},\n      'currentCoors': {},\n      'viagem': {}\n    };\n  }\n\n  onAddressChange(evt) {\n    const id = evt.target.id;\n    const val = evt.target.value;\n    let state = this.state;\n    state.address[id] = val;\n    this.setState(state);\n  }\n\n  onCheck(evt) {\n    let params = {\n      'apiKey': API_KEY\n    };\n\n    if (this.state.locationId.length > 0) {\n      params['locationId'] = this.state.locationId;\n    } else {\n      params['searchtext'] = this.state.address.street + this.state.address.city + this.state.address.postalCode + this.state.address.country;\n    } // --------------------------------------—————---\n    // -------- CHECK ADDRESS AND ROUTE -------------\n    // --------------------------------------—————---\n\n\n    const self = this;\n    axios.get('https://geocoder.ls.hereapi.com/6.2/geocode.json', {\n      'params': params\n    }).then(function (response) {\n      console.log(\"validar\");\n      console.log(response);\n      const view = response.data.Response.View;\n      const location = view[0].Result[0].Location;\n      self.setState({\n        'isChecked': 'true',\n        'locationId': '',\n        'query': location.Address.Label,\n        'address': {\n          'street': location.Address.Street,\n          'city': location.Address.City,\n          'postalCode': location.Address.PostalCode,\n          'country': location.Address.Country\n        },\n        'coordsDestino': {\n          'latitude': location.DisplayPosition.Latitude,\n          'longitude': location.DisplayPosition.Longitude\n        }\n      });\n    }); // localizacao atual\n\n    const current = this;\n    navigator.geolocation.getCurrentPosition(function (position) {\n      current.setState({\n        'currentCoors': {\n          'latitude': position.coords.latitude,\n          'longitude': position.coords.longitude\n        }\n      });\n    }); //console.log(\"teste latitude\");\n    //console.log(this.setState.currentCoors.latitude);\n  }\n\n  verificaEndereco() {\n    if (!this.state.isChecked) {\n      return;\n    } //console.log(\"##Latitude is :\", this.state.currentCoors.latitude);\n    //console.log(\"$$$Longitude is :\", this.state.currentCoors.longitude);\n    //console.log(\"###Distancia\", this.state.viagem.distance);\n    //console.log(\"###Tempo\", this.state.viagem.travelTime);\n\n\n    if (this.state.coordsDestino === null) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        id: \"erro\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 9\n        }\n      }, \"Enderen\\xE7o inv\\xE1lido!\");\n    } else {\n      // request route\n      const simpleRoute = this;\n      axios.get('https://route.ls.hereapi.com/routing/7.2/calculateroute.json', {\n        'params': {\n          'apiKey': API_KEY,\n          'waypoint0': this.state.currentCoors.latitude + ',' + this.state.currentCoors.latitude,\n          'waypoint1': this.state.coordsDestino.latitude + ',' + this.state.coordsDestino.longitude,\n          //'mode': 'fastest;car;traffic:enabled',\n          'mode': 'shortest;car;traffic:enabled'\n        }\n      }).then(result => {\n        console.log(\"request route\");\n        console.log(result.data);\n        console.log(\"distancia e tempo\");\n        console.log(result.data.response.route[0].summary.distance);\n        console.log(result.data.response.route[0].summary.travelTime); //console.log(\"teste latitude\");\n        //console.log(this.setState.currentCoors.latitude);\n\n        const rota = result.data.response.route[0].summary;\n        var precoV = rota.distance / 10000 * 0.70 + rota.travelTime / 60 / 60 * 0.30;\n        simpleRoute.setState({\n          'viagem': {\n            'distance': rota.distance / 10000,\n            'travelTime': rota.travelTime / 60 / 60,\n            'preco': precoV\n          }\n        });\n      }, error => {\n        console.error(error);\n      });\n      return /*#__PURE__*/React.createElement(\"div\", {\n        id: \"resultados\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 9\n        }\n      }, \"Coordenadas Atuais: \", this.state.currentCoors.latitude, \", \", this.state.currentCoors.longitude, /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 10\n        }\n      }), \"Coordenadas Destino: \", this.state.coordsDestino.latitude, \", \", this.state.coordsDestino.longitude, /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 10\n        }\n      }), \"Distancia: \", this.state.viagem.distance, \" km\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }\n      }), \"Tempo: \", this.state.viagem.travelTime, \" min\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 52\n        }\n      }), \"Pre\\xE7o: \", this.state.viagem.preco, \" \\u20AC\");\n    }\n  }\n\n  render() {\n    var verifyAdress = this.verificaEndereco();\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(AddressSuggest, {\n      query: this.state.query //text\n      ,\n      onChange: this.onQuery,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(AddressInput, {\n      street: this.state.address.street,\n      city: this.state.address.city,\n      postalCode: this.state.address.postalCode,\n      country: this.state.address.country,\n      onChange: this.onAddressChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 11\n      }\n    }), verifyAdress, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      onClick: this.onCheck,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 11\n      }\n    }, \"Ver pre\\xE7o!\"));\n  }\n\n}\n\nexport default AddressForm;","map":{"version":3,"sources":["/Users/renatosantos/Dropbox/Aplicativos/NONIO-Inforestudante/Licenciatura em Engenharia Informática/2019 2020/2.º Semestre/Engenharia de Serviços/Service-Engineering-Project/src/AddressForm.js"],"names":["React","Component","AddressSuggest","AddressInput","axios","TranscribeFetch","Route53Resolver","API_KEY","AddressForm","constructor","props","state","getInitialState","onQuery","bind","onAddressChange","onCheck","evt","query","target","value","self","get","then","response","console","log","data","suggestions","length","id","locationId","address","setState","textTranscribe","body","val","params","street","city","postalCode","country","view","Response","View","location","Result","Location","Address","Label","Street","City","PostalCode","Country","DisplayPosition","Latitude","Longitude","current","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","verificaEndereco","isChecked","coordsDestino","simpleRoute","currentCoors","result","route","summary","distance","travelTime","rota","precoV","error","viagem","preco","render","verifyAdress"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport AddressSuggest from './AddressSuggest';\nimport AddressInput from './AddressInput';\nimport axios from 'axios';\nimport TranscribeFetch from './getTranscribeStatus';\nimport { Route53Resolver } from 'aws-sdk';\n\nconst API_KEY = 'tX1z9uiD44rPpVd1CGR_eG3VBZ4mubljw0ljaLFIaRQ';\n\nclass AddressForm extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = this.getInitialState();\n    // User has entered something in the address bar\n    this.onQuery = this.onQuery.bind(this);\n    // User has entered something in an address field\n    this.onAddressChange = this.onAddressChange.bind(this);\n    // User has clicked the check button\n    this.onCheck = this.onCheck.bind(this);\n  }\n\n  onQuery(evt) {\n    const query = evt.target.value;\n\n  \n\n    const self = this;\n    axios.get('https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json',\n      {'params': {\n        'query': query,\n        'apiKey': API_KEY,\n        'maxresults': 20, // nr de resultados relacionados com a palavras pesquisadas\n      }}).then(function (response) {\n        console.log(\"sugestao\");\n          console.log(response);\n          if (response.data.suggestions.length > 0) {\n            const id = response.data.suggestions[0].locationId;\n            const address = response.data.suggestions[0].address;\n            self.setState({\n              'address' : address,\n              'query' : query,\n              'locationId': id\n            })\n          } else {\n            const state = self.getInitialState();\n            self.setState(state);\n          }\n      });\n  }\n  \n  getInitialState() {\n    //console.log(this.getText());\n    var textTranscribe = this\n    axios.get('https://3xeam2g64j.execute-api.us-east-1.amazonaws.com/transcribe/transcribe'\n      ).then(function (response) {\n          textTranscribe = response.data.body;\n          console.log(\"llll \"+textTranscribe); //right string\n      });\n    //console.log(\"trans...\"+JSON.stringify(textTranscribe)); // object object\n    console.log(\"----- transcribe ------\");\n    console.log(textTranscribe);\n    return {\n      'address': {\n        'street': '',//textTranscribe.toString(), //white white, //inserir aqui texto do transcribe\n        'city': '',\n        'postalCode': '',\n        'country': ''\n      },\n      'query': '',\n      'locationId': '',\n      'isChecked': false,\n      'coords': {},\n      'currentCoors':{},\n      'viagem':{},\n    }\n  }\n\n  onAddressChange(evt) {\n    const id = evt.target.id\n    const val = evt.target.value\n\n    let state = this.state\n    state.address[id] = val;\n    this.setState(state);\n  }\n\n  onCheck(evt) {\n    let params = {\n        'apiKey': API_KEY,\n    }\n\n    if (this.state.locationId.length > 0) {\n      params['locationId'] = this.state.locationId;\n    } else {\n      params['searchtext'] = \n        this.state.address.street\n        + this.state.address.city\n        + this.state.address.postalCode\n        + this.state.address.country;\n    }\n\n    // --------------------------------------—————---\n    // -------- CHECK ADDRESS AND ROUTE -------------\n    // --------------------------------------—————---\n\n    const self = this;\n    axios.get('https://geocoder.ls.hereapi.com/6.2/geocode.json',\n      {'params': params }\n      ).then(function (response) {\n        console.log(\"validar\");\n        console.log(response);\n        const view = response.data.Response.View\n        const location = view[0].Result[0].Location;\n\n        self.setState({\n          'isChecked': 'true',\n          'locationId': '',\n          'query': location.Address.Label,\n          'address': {\n            'street': location.Address.Street,\n            'city': location.Address.City,\n            'postalCode': location.Address.PostalCode,\n            'country': location.Address.Country\n          },\n          'coordsDestino': {\n            'latitude': location.DisplayPosition.Latitude,\n            'longitude': location.DisplayPosition.Longitude\n          }\n        })\n      })\n      \n    // localizacao atual\n    const current = this;\n    navigator.geolocation.getCurrentPosition(function(position) {\n      current.setState({\n        'currentCoors':{\n          'latitude': position.coords.latitude,\n          'longitude': position.coords.longitude,\n        }\n      });\n    });\n\n    //console.log(\"teste latitude\");\n    //console.log(this.setState.currentCoors.latitude);\n  }\n\n  verificaEndereco() {\n    if (!this.state.isChecked) {\n      return;\n    }\n    //console.log(\"##Latitude is :\", this.state.currentCoors.latitude);\n    //console.log(\"$$$Longitude is :\", this.state.currentCoors.longitude);\n    //console.log(\"###Distancia\", this.state.viagem.distance);\n    //console.log(\"###Tempo\", this.state.viagem.travelTime);\n\n    if (this.state.coordsDestino === null) {\n      return (\n        <div id=\"erro\">\n          Enderenço inválido!\n        </div>\n      );\n    } else {\n          // request route\n          const simpleRoute = this;\n          axios.get('https://route.ls.hereapi.com/routing/7.2/calculateroute.json',\n            {'params': {\n              'apiKey': API_KEY,\n              'waypoint0': this.state.currentCoors.latitude+','+this.state.currentCoors.latitude,\n              'waypoint1': this.state.coordsDestino.latitude+','+this.state.coordsDestino.longitude,\n              //'mode': 'fastest;car;traffic:enabled',\n              'mode': 'shortest;car;traffic:enabled',\n            }}).then(result => {\n              console.log(\"request route\");\n              console.log(result.data);\n              console.log(\"distancia e tempo\");\n              console.log(result.data.response.route[0].summary.distance);\n              console.log(result.data.response.route[0].summary.travelTime);\n\n              //console.log(\"teste latitude\");\n              //console.log(this.setState.currentCoors.latitude);\n\n              const rota = result.data.response.route[0].summary;\n              var precoV = (rota.distance/10000) * 0.70 + (rota.travelTime/60/60) * 0.30;\n              simpleRoute.setState({\n                'viagem':{\n                  'distance': rota.distance/10000,\n                  'travelTime': rota.travelTime/60/60,\n                  'preco': precoV,\n                }\n              })\n              },error => {\n                console.error(error);\n              });\n\n      return (\n        <div id=\"resultados\">\n         Coordenadas Atuais: {this.state.currentCoors.latitude}, {this.state.currentCoors.longitude}\n         <br></br>\n         Coordenadas Destino: {this.state.coordsDestino.latitude}, {this.state.coordsDestino.longitude}\n         <br></br>\n          Distancia: {this.state.viagem.distance} km\n          <br></br>\n          Tempo: {this.state.viagem.travelTime} min<br></br>\n          Preço: {this.state.viagem.preco} €\n        </div>\n      );\n    }\n  }\n\n  render() {\n    var verifyAdress = this.verificaEndereco();\n    return (\n        <div>\n          <AddressSuggest\n            query={this.state.query} //text\n            onChange={this.onQuery} \n            />\n          <AddressInput\n            street={this.state.address.street}\n            city={this.state.address.city}\n            postalCode={this.state.address.postalCode}\n            country={this.state.address.country}\n            onChange={this.onAddressChange}\n            />\n          <br/>\n          {verifyAdress}\n          <button type=\"submit\" onClick={this.onCheck}>Ver preço!</button>\n        </div>\n      );\n  }\n}\n\nexport default AddressForm;"]},"metadata":{},"sourceType":"module"}