{"ast":null,"code":"const AWS = require('aws-sdk');\n\nconst Busboy = require('busboy');\n\nconst BUCKET_NAME = 'proj-es-s3';\nconst AWS_USER_KEY = 'ASIA6HCXC5ABSN4GFDMY';\nconst AWS_USER_SECRET = '/csTc6BegqNb/arlPd34fuA828qmE98c0SOZMlPE';\n\nmodule.exports = app => {\n  app.post('/api/upload', function (req, res, next) {\n    const element1 = req.body.element1;\n    var busboy = new Busboy({\n      headers: req.headers\n    });\n    console.log('element1');\n    console.log(element1);\n    busboy.on('finish', function () {\n      console.log('Upload finished');\n      console.log('files:');\n      console.log(req.files);\n      const file = req.files.element2;\n      console.log(file);\n      let s3bucket = new AWS.S3({\n        accessKeyId: AWS_USER_KEY,\n        secretAccessKey: AWS_USER_SECRET,\n        Bucket: BUCKET_NAME\n      });\n      s3bucket.createBucket(function () {\n        var params = {\n          Bucket: BUCKET_NAME,\n          Key: file.name,\n          Body: file.data\n        };\n        s3bucket.upload(params, function (err, data) {\n          if (err) {\n            console.log('error in callback');\n            console.log(err);\n          }\n\n          console.log('success');\n          console.log(data);\n        });\n      });\n    });\n    req.pipe(busboy);\n  });\n};","map":{"version":3,"sources":["E:/GitHub/ReactTest/src/uploadS3.js"],"names":["AWS","require","Busboy","BUCKET_NAME","AWS_USER_KEY","AWS_USER_SECRET","module","exports","app","post","req","res","next","element1","body","busboy","headers","console","log","on","files","file","element2","s3bucket","S3","accessKeyId","secretAccessKey","Bucket","createBucket","params","Key","name","Body","data","upload","err","pipe"],"mappings":"AACA,MAAMA,GAAG,GAAGC,OAAO,CAAC,SAAD,CAAnB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AAEA,MAAME,WAAW,GAAG,YAApB;AACA,MAAMC,YAAY,GAAG,sBAArB;AACA,MAAMC,eAAe,GAAG,0CAAxB;;AAEAC,MAAM,CAACC,OAAP,GAAkBC,GAAD,IAAS;AAEtBA,EAAAA,GAAG,CAACC,IAAJ,CAAS,aAAT,EAAwB,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAC9C,UAAMC,QAAQ,GAAGH,GAAG,CAACI,IAAJ,CAASD,QAA1B;AACA,QAAIE,MAAM,GAAG,IAAIb,MAAJ,CAAW;AAAEc,MAAAA,OAAO,EAAEN,GAAG,CAACM;AAAf,KAAX,CAAb;AAEAC,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAYL,QAAZ;AAEAE,IAAAA,MAAM,CAACI,EAAP,CAAU,QAAV,EAAoB,YAAW;AAC3BF,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AAEAD,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYR,GAAG,CAACU,KAAhB;AAGA,YAAMC,IAAI,GAAGX,GAAG,CAACU,KAAJ,CAAUE,QAAvB;AACAL,MAAAA,OAAO,CAACC,GAAR,CAAYG,IAAZ;AAEA,UAAIE,QAAQ,GAAG,IAAIvB,GAAG,CAACwB,EAAR,CAAW;AACtBC,QAAAA,WAAW,EAAErB,YADS;AAEtBsB,QAAAA,eAAe,EAAErB,eAFK;AAGtBsB,QAAAA,MAAM,EAAExB;AAHc,OAAX,CAAf;AAKAoB,MAAAA,QAAQ,CAACK,YAAT,CAAsB,YAAY;AAC5B,YAAIC,MAAM,GAAG;AACXF,UAAAA,MAAM,EAAExB,WADG;AAEX2B,UAAAA,GAAG,EAAET,IAAI,CAACU,IAFC;AAGXC,UAAAA,IAAI,EAAEX,IAAI,CAACY;AAHA,SAAb;AAKAV,QAAAA,QAAQ,CAACW,MAAT,CAAgBL,MAAhB,EAAwB,UAAUM,GAAV,EAAeF,IAAf,EAAqB;AAC3C,cAAIE,GAAJ,EAAS;AACPlB,YAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAD,YAAAA,OAAO,CAACC,GAAR,CAAYiB,GAAZ;AACD;;AACDlB,UAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACAD,UAAAA,OAAO,CAACC,GAAR,CAAYe,IAAZ;AACD,SAPD;AAQL,OAdD;AAeH,KA9BD;AA+BAvB,IAAAA,GAAG,CAAC0B,IAAJ,CAASrB,MAAT;AACH,GAvCD;AAwCD,CA1CH","sourcesContent":["\r\nconst AWS = require('aws-sdk');\r\nconst Busboy = require('busboy');\r\n\r\nconst BUCKET_NAME = 'proj-es-s3';\r\nconst AWS_USER_KEY = 'ASIA6HCXC5ABSN4GFDMY';\r\nconst AWS_USER_SECRET = '/csTc6BegqNb/arlPd34fuA828qmE98c0SOZMlPE';\r\n\r\nmodule.exports = (app) => {\r\n      \r\n    app.post('/api/upload', function (req, res, next) {\r\n        const element1 = req.body.element1;  \r\n        var busboy = new Busboy({ headers: req.headers });  \r\n\r\n        console.log('element1');\r\n        console.log(element1);\r\n\r\n        busboy.on('finish', function() {\r\n            console.log('Upload finished');\r\n\r\n            console.log('files:');\r\n            console.log(req.files);\r\n            \r\n            \r\n            const file = req.files.element2;\r\n            console.log(file)\r\n\r\n            let s3bucket = new AWS.S3({\r\n                accessKeyId: AWS_USER_KEY,\r\n                secretAccessKey: AWS_USER_SECRET,\r\n                Bucket: BUCKET_NAME\r\n              });\r\n            s3bucket.createBucket(function () {\r\n                  var params = {\r\n                    Bucket: BUCKET_NAME,\r\n                    Key: file.name,\r\n                    Body: file.data\r\n                  };\r\n                  s3bucket.upload(params, function (err, data) {\r\n                    if (err) {\r\n                      console.log('error in callback');\r\n                      console.log(err);\r\n                    }\r\n                    console.log('success');\r\n                    console.log(data);\r\n                  });\r\n            });\r\n        });  \r\n        req.pipe(busboy);\r\n    });\r\n  }\r\n"]},"metadata":{},"sourceType":"module"}